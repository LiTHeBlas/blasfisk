server {
    server_name pekka.litheblas.org;
    listen [::]:80;  # IPv4 and IPv6

    gzip on;
    gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript image/svg+xml;

    access_log off;

    location /static/ {
        alias /var/www/blasfisk/static/;
    }

    location /media/ {
        alias /var/www/blasfisk/media/;
    }

    # START OF OLD SITE PROXYING
    # These locations shouldn't be much of a problem for the new site, since it uses language coded URLs for almost everything.
    location /sendpass.php {
        proxy_pass http://skorpan.litheblas.org/sendpass.php;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /internt/ {
        proxy_pass http://skorpan.litheblas.org/internt/;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Real-IP $remote_addr;
        client_max_body_size 1024m;  # Allow requests up to 1GB (for gallery uploads).
    }

    location /vcal/ {
        proxy_pass http://skorpan.litheblas.org/vcal/;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /images/ {
        proxy_pass http://skorpan.litheblas.org/images/;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /bilder/ {
        proxy_pass http://skorpan.litheblas.org/bilder/;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /css/ {
        proxy_pass http://skorpan.litheblas.org/css/;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Real-IP $remote_addr;
    }
    # END OF OLD SITE PROXYING

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header X-Forwarded-Host $server_name;
        proxy_set_header X-Real-IP $remote_addr;

        # TODO: Check what these actually do.
        add_header P3P 'CP="ALL DSP COR PSAa PSDa OUR NOR ONL UNI COM NAV"';
    }
}